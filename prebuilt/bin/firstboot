#! /system/bin/sh
#
# firstboot.sh
# WesGarner for OpenEclair

{
    CPUINFO=$(cat /proc/cpuinfo | busybox grep Hardware | busybox cut - -d ' ' -f 2,3);
    if [ "${CPUINFO}" == "sapphire" ]; then
	echo "---AudioPara4.csv fix";
	    mv /system/etc/AudioPara4-sapphire.csv /system/etc/AudioPara4.csv; > /dev/null
	
    fi;
}

echo "--- Symlinking Media Folder";
	busybox rm -r /data/.media;  > /dev/null
	busybox ln -s /data/media /system/media;

echo "--- Symlinking some System Apps";
busybox rm -r /data/app_s;
busybox mv /data/app_s_tmp /data/app_s;
for sysapp in /data/app_s/* ; do
	if [ -e /system/app/$(basename $sysapp) ]; then
		busybox rm /system/app/$(basename $sysapp); > /dev/null
	fi;
	if [ -h /system/app/$(basename $sysapp) ]; then
		busybox rm /system/app/$(basename $sysapp); > /dev/null
	fi;
	busybox ln -s $sysapp /system/app/$(basename $sysapp);
	echo "$sysapp Symlinked to data partition";
done;

echo "--- Running autozipalign.";
        if [ -e /system/bin/autozipalign ]; then
            /system/bin/sh /system/bin/autozipalign;
        fi;

echo "--- Setting permissions so wifi doesn't crap out";
mkdir /data/misc/wifi
chmod 0770 /data/misc/wifi;
chown wifi.wifi /data/misc/wifi;
chmod 0660 /data/misc/wifi/wpa_supplicant.conf;
chown wifi.wifi /data/misc/wifi/wpa_supplicant.conf;
mkdir /data/misc/wifi/sockets;
chown wifi.wifi /data/misc/wifi/sockets;
chmod 0770 /data/misc/wifi/sockets;
mkdir /data/misc/dhcp;
chown dhcp.dhcp /data/misc/dhcp;
chmod 0770 /data/misc/dhcp;
